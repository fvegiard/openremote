services:
  # Dev container with SSH access and exposed ports for Tailscale VPN access
  ohmyopencode:
    build: .
    ports:
      - "2222:22"    # SSH access
      - "5173:5173"  # Vite dev server
      - "4096:4096"  # OpenCode web UI
    environment:
      GITHUB_REPO_URL: "${GITHUB_REPO_URL}"
      GITHUB_TOKEN: "${GITHUB_TOKEN}"
      # LLM Configuration
      LLM_MODEL: "${LLM_MODEL}"
      LLM_BASE_URL: "${LLM_BASE_URL}"
      LLM_API_KEY: "${LLM_API_KEY}"
      OPENAI_BASE_URL: "${OPENAI_BASE_URL}"
      OPENAI_API_KEY: "${OPENAI_API_KEY}"
      # Cloud Providers
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"
      GOOGLE_API_KEY: "${GOOGLE_API_KEY}"
      OPENROUTER_API_KEY: "${OPENROUTER_API_KEY}"
      # MCP keys
      CONTEXT7_API_KEY: "${CONTEXT7_API_KEY}"
      # SSH Access
      SSH_PUBLIC_KEY: "${SSH_PUBLIC_KEY}"
      RALPH_SLACK_WEBHOOK_URL: "${RALPH_SLACK_WEBHOOK_URL}"
    volumes:
      - ./workspace:/workspace
      - dev_home:/home/dev
    command: ["sleep", "infinity"]

  # Devcontainer helper (keeps a container alive for VS Code attachment)
  devcontainer:
    build: .
    profiles: ["devcontainer"]
    command: ["sleep", "infinity"]
    volumes:
      - ./:/workspace

volumes:
  dev_home:
