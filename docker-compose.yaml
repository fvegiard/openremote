services:
  # ── Lena — Autonomous AI Dev Container ────────────────────
  lena:
    build: .
    container_name: lena
    hostname: lena
    ports:
      - "2222:22"    # SSH access
      - "5173:5173"  # Vite dev server
      - "4096:4096"  # OpenCode web UI
    environment:
      GITHUB_REPO_URL: "${GITHUB_REPO_URL}"
      GITHUB_TOKEN: "${GITHUB_TOKEN}"
      # LLM Configuration
      LLM_MODEL: "${LLM_MODEL}"
      LLM_BASE_URL: "${LLM_BASE_URL}"
      LLM_API_KEY: "${LLM_API_KEY}"
      OPENAI_BASE_URL: "${OPENAI_BASE_URL}"
      OPENAI_API_KEY: "${OPENAI_API_KEY}"
      # Cloud Providers
      ANTHROPIC_API_KEY: "${ANTHROPIC_API_KEY}"
      GOOGLE_API_KEY: "${GOOGLE_API_KEY}"
      OPENROUTER_API_KEY: "${OPENROUTER_API_KEY}"
      # Ollama (local GPU on host)
      OLLAMA_HOST: "http://host.docker.internal:11434"
      # MCP keys
      CONTEXT7_API_KEY: "${CONTEXT7_API_KEY}"
      # SSH Access
      SSH_PUBLIC_KEY: "${SSH_PUBLIC_KEY}"
      RALPH_SLACK_WEBHOOK_URL: "${RALPH_SLACK_WEBHOOK_URL}"
    volumes:
      - ./workspace:/workspace
      - lena_home:/home/lena
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: ["sleep", "infinity"]

  # Devcontainer helper (keeps a container alive for VS Code / Antigravity attachment)
  devcontainer:
    build: .
    profiles: ["devcontainer"]
    command: ["sleep", "infinity"]
    volumes:
      - ./:/workspace

volumes:
  lena_home:
